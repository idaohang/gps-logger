<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>gLogger Mini: /home/martin/GitHub/gps-logger/src/modules/gps.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">gLogger Mini
   &#160;<span id="projectnumber">1.6</span>
   </div>
   <div id="projectbrief">A simple and small GPS logging device</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('gps_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">/home/martin/GitHub/gps-logger/src/modules/gps.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Library for handling the GPS-module.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="gps_8h_source.html">modules/gps.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gps_8c.html#a365fd1afb6dde0cbfbac1b27ae2876dd">gps_init</a> (uint8_t pFrequency, uint8_t pMessages)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the GPS-module. Locks the processor in case of error.  <a href="#a365fd1afb6dde0cbfbac1b27ae2876dd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gps_8c.html#acc2cafbcc2535bc476c6891960bf7adb">gps_highspeed</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Prompts the GPS to send data with a higher baudrate and reinitializes the UART port.  <a href="#acc2cafbcc2535bc476c6891960bf7adb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gps_8c.html#a24b4222be585320c07f424b9058b2412">gps_calculateCS</a> (const unsigned char *pPayload, uint16_t pLength)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gps_8c.html#a35b229863f20f27bee0bdc7d8d925fef">gps_setParam</a> (unsigned char pCommand, unsigned char *pData, uint16_t pLength)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets a parameter of the GPS-module to a given value.  <a href="#a35b229863f20f27bee0bdc7d8d925fef"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gps_8c.html#ac0bb29da258e674d92ce09a18d6bb5ac">gps_checkNMEA</a> (const char *pSentence, uint8_t pMessageType, char *pPrefix, uint8_t pValidityToken, char *pValidityCheck, uint8_t pCheckEquality)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the given sentence meets the criteria for a valid message.  <a href="#ac0bb29da258e674d92ce09a18d6bb5ac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gps_8c.html#a00a21736c09af5bf159556d94313184a">gps_getNMEA</a> (char *pOutput, uint8_t pMaxLength)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes a NMEA-String into the given output buffer and returns its type.  <a href="#a00a21736c09af5bf159556d94313184a"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Library for handling the GPS-module. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Martin Matysiak </dd></dl>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a24b4222be585320c07f424b9058b2412"></a><!-- doxytag: member="gps.c::gps_calculateCS" ref="a24b4222be585320c07f424b9058b2412" args="(const unsigned char *pPayload, uint16_t pLength)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="gps_8c.html#a24b4222be585320c07f424b9058b2412">gps_calculateCS</a> </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>pPayload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>pLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac0bb29da258e674d92ce09a18d6bb5ac"></a><!-- doxytag: member="gps.c::gps_checkNMEA" ref="ac0bb29da258e674d92ce09a18d6bb5ac" args="(const char *pSentence, uint8_t pMessageType, char *pPrefix, uint8_t pValidityToken, char *pValidityCheck, uint8_t pCheckEquality)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="gps_8h.html#ac0bb29da258e674d92ce09a18d6bb5ac">gps_checkNMEA</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pSentence</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pMessageType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pValidityToken</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pValidityCheck</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pCheckEquality</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks if the given sentence meets the criteria for a valid message. </p>
<p>This method checks several properties, some of them will only indicate if the message can be considered as "valid" or not, others will say more generally if the given message is in a correct format.</p>
<p>In detail, the method sweeps through the sentence once, while:</p>
<ul>
<li>Performing a prefix check (return instantly if invalid)</li>
<li>Searching for pValidityToken and comparing it with pValidityCheck</li>
<li>Calculating the checksum and comparing it to given one (if given) WARNING: Long and ugly code ahead ;-)</li>
</ul>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pSentence</td><td>The sentence which shall be checked </td></tr>
    <tr><td class="paramname">pMessageType</td><td>The message type which is expected </td></tr>
    <tr><td class="paramname">pPrefix</td><td>The prefix (== message type) that the sentence is supposed to have </td></tr>
    <tr><td class="paramname">pValidityToken</td><td>The index of a token (a token is delimited by commas) in which a validity information can be found. Set to 0 if no validity check should be performed. Token 1 begins after the first comma (i.e. the first data after the "$GP..." type string) </td></tr>
    <tr><td class="paramname">pValidityCheck</td><td>A string to which the validityToken should be compared </td></tr>
    <tr><td class="paramname">pCheckEquality</td><td>If TRUE, the sentence is considered valid if the validityToken equals the validityCheck string, otherwise if they are unequal </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>GPS_NMEA_UNKNOWN if the message has a corrupt format (i.e. prefix or checksum mismatch), otherwise a composition of GPS_NMEA_&lt;TYPE&gt; | {GPS_NMEA_ VALID or GPS_NMEA_INVALID}. If pValidityToken is zero, GPS_NMEA_VALID will be returned in combination with the type as we assume that this specific message type is always valid. </dd></dl>

</div>
</div>
<a class="anchor" id="a00a21736c09af5bf159556d94313184a"></a><!-- doxytag: member="gps.c::gps_getNMEA" ref="a00a21736c09af5bf159556d94313184a" args="(char *pOutput, uint8_t pMaxLength)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="gps_8h.html#a00a21736c09af5bf159556d94313184a">gps_getNMEA</a> </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pOutput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pMaxLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Writes a NMEA-String into the given output buffer and returns its type. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pOutput</td><td>The buffer in which the NMEA string shall be written </td></tr>
    <tr><td class="paramname">pMaxLength</td><td>The buffer's maximal length </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A byte composed of the message type (bits 1-7) and a bit indicating if the message is valid or not (bit 0). </dd></dl>

</div>
</div>
<a class="anchor" id="acc2cafbcc2535bc476c6891960bf7adb"></a><!-- doxytag: member="gps.c::gps_highspeed" ref="acc2cafbcc2535bc476c6891960bf7adb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="gps_8h.html#acc2cafbcc2535bc476c6891960bf7adb">gps_highspeed</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prompts the GPS to send data with a higher baudrate and reinitializes the UART port. </p>

</div>
</div>
<a class="anchor" id="a365fd1afb6dde0cbfbac1b27ae2876dd"></a><!-- doxytag: member="gps.c::gps_init" ref="a365fd1afb6dde0cbfbac1b27ae2876dd" args="(uint8_t pFrequency, uint8_t pMessages)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="gps_8h.html#a365fd1afb6dde0cbfbac1b27ae2876dd">gps_init</a> </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pFrequency</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>pMessages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initializes the GPS-module. Locks the processor in case of error. </p>
<p>The parameters can be used to configure the output produced by the GPS. Please note that certain limitations exist for the parameters values.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pFrequency</td><td>The frequency (in Hertz) in which NMEA-sentences should be returned. The module supports only a value of the set {1,2,4,5,8,10}. Only the values {1,2} are supported by the gLogger-Firmware right now! Higher frequencies may or may not work. </td></tr>
    <tr><td class="paramname">pMessages</td><td>A bitset containing the messages which should be returned in each message block. Multiple messages can be selected by using the OR-operator on the constant values. Possible constant values are {GPS_NMEA_GGA, GPS_NMEA_RMC, GPS_NMEA_GSA, GPS_NMEA_GSV, GPS_NMEA_GLL, GPS_NMEA_VTG, GPS_NMEA_ZDA}. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a35b229863f20f27bee0bdc7d8d925fef"></a><!-- doxytag: member="gps.c::gps_setParam" ref="a35b229863f20f27bee0bdc7d8d925fef" args="(unsigned char pCommand, unsigned char *pData, uint16_t pLength)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="gps_8h.html#a35b229863f20f27bee0bdc7d8d925fef">gps_setParam</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>pCommand</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>pData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>pLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sets a parameter of the GPS-module to a given value. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pCommand</td><td>The parameter which should be set (see constants) </td></tr>
    <tr><td class="paramname">pData</td><td>The data which should be written for this parameter </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>GPS_ACK on success, otherwise GPS_NACK </dd></dl>

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="gps_8c.html">gps.c</a>      </li>

    <li class="footer">Generated on Sun Apr 8 2012 14:53:03 for gLogger Mini by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
